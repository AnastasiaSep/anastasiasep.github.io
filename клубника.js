// –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:
const products = [
    // 1. –°–ª–∞–¥–∫–∞—è –¥–µ–≤–æ—á–∫–∞ ‚Äî –±–æ–ª—å—à–µ –±–µ–ª–æ–≥–æ/—Ä–æ–∑–æ–≤–æ–≥–æ
    {
        id: 1,
        name: '–ù–∞–±–æ—Ä "–°–ª–∞–¥–∫–∞—è –¥–µ–≤–æ—á–∫–∞"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–ù–∞–±–æ—Ä "–°–ª–∞–¥–∫–∞—è –¥–µ–≤–æ—á–∫–∞" - –∏–¥–µ–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä. –ö–∞–∂–¥–∞—è —Å–æ—á–Ω–∞—è –∫–ª—É–±–Ω–∏–∫–∞ –æ–±–≤–æ–ª–∞–∫–∏–≤–∞–µ—Ç—Å—è –Ω–µ–∂–Ω—ã–º –±–µ–ª—ã–º –∏ —Ä–æ–∑–æ–≤—ã–º —à–æ–∫–æ–ª–∞–¥–æ–º, —É–∫—Ä–∞—à–∞–µ—Ç—Å—è –∫–æ–∫–æ—Å–æ–≤–æ–π —Å—Ç—Ä—É–∂–∫–æ–π.',
        image: '12.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, –±–µ–ª—ã–π –∏ —Ä–æ–∑–æ–≤—ã–π —à–æ–∫–æ–ª–∞–¥, –∫–æ–∫–æ—Å–æ–≤–∞—è —Å—Ç—Ä—É–∂–∫–∞, –ø–æ—Å—ã–ø–∫–∞ —à–∞—Ä–∏–∫–∏',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 397000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 529000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 595000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 793000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 1057000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1190000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1586000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1784000 }
        ]
    },

    // 2. Golden Strawberry ‚Äî –±–æ–ª—å—à–µ –º–æ–ª–æ—á–Ω–æ–≥–æ
    {
        id: 2,
        name: '–ù–∞–±–æ—Ä "Golden Strawberry"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä –∫–ª—É–±–Ω–∏–∫–∏, –ø–æ–∫—Ä—ã—Ç–æ–π –±–µ–ª—ã–º –∏ –º–æ–ª–æ—á–Ω—ã–º —à–æ–∫–æ–ª–∞–¥–æ–º —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å—ä–µ–¥–æ–±–Ω–æ–≥–æ –∑–æ–ª–æ—Ç–∞.',
        image: '14.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –±–µ–ª—ã–π —à–æ–∫–æ–ª–∞–¥, –ø–∏—â–µ–≤–æ–µ –∑–æ–ª–æ—Ç–æ',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 372000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 497000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 559000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 745000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 993000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1117000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1490000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1676000 }
        ]
    },

    // 3. –ö–ª—É–±–Ω–∏—á–Ω–∞—è –¥—Ä–∞–º–∞ ‚Äî –º–∏–∫—Å, –±–µ—Ä—ë–º ¬´—Å—Ä–µ–¥–Ω—é—é¬ª –º–µ–∂–¥—É milk –∏ white
    {
        id: 3,
        name: '–ù–∞–±–æ—Ä "–ö–ª—É–±–Ω–∏—á–Ω–∞—è –¥—Ä–∞–º–∞"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 12 —è–≥–æ–¥',
        fullDescription: '–ò–¥–µ–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∏–∑—ã—Å–∫–∞–Ω–Ω—ã—Ö –¥–µ—Å–µ—Ä—Ç–æ–≤ —Å –º–∏–∫—Å–æ–º —Ç—ë–º–Ω–æ–≥–æ, –º–æ–ª–æ—á–Ω–æ–≥–æ, –±–µ–ª–æ–≥–æ –∏ —Ä–æ–∑–æ–≤–æ–≥–æ —à–æ–∫–æ–ª–∞–¥–∞.',
        image: '15.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, —Ç—ë–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –±–µ–ª—ã–π —à–æ–∫–æ–ª–∞–¥, —Ä–æ–∑–æ–≤—ã–π —à–æ–∫–æ–ª–∞–¥, –¥–µ–∫–æ—Ä',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 385000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 513000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 577000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 771000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 1025000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1153000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1538000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1730000 }
        ]
    },

    // 4. –õ—é–∫—Å ‚Äî –º–Ω–æ–≥–æ —Ç—ë–º–Ω–æ–≥–æ —à–æ–∫–æ–ª–∞–¥–∞
    {
        id: 4,
        name: '–ù–∞–±–æ—Ä "–õ—é–∫—Å"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Å –∫–ª—É–±–Ω–∏–∫–æ–π, –ø–æ–∫—Ä—ã—Ç–æ–π —Ç—ë–º–Ω—ã–º –∏ –º–æ–ª–æ—á–Ω—ã–º —à–æ–∫–æ–ª–∞–¥–æ–º –∏ —É–∫—Ä–∞—à–µ–Ω–Ω–æ–π –æ—Ä–µ—Ö–∞–º–∏, –∫–æ–∫–æ—Å–æ–º –∏ –∑–æ–ª–æ—Ç–æ–π –ø–æ—Å—ã–ø–∫–æ–π.',
        image: '17.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, —Ç—ë–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –∫–æ–∫–æ—Å–æ–≤–∞—è —Å—Ç—Ä—É–∂–∫–∞, –∑–æ–ª–æ—Ç–∞—è –ø–æ—Å—ã–ø–∫–∞',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 373000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 498000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 560000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 747000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 996000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1120000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1493000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1680000 }
        ]
    },

    // 5. –°—Ç—Ä–∞—Å—Ç—å –ø–æ–ø–æ–ª–∞–º ‚Äî –±–ª–∏–∂–µ –∫ milk
    {
        id: 5,
        name: '–ù–∞–±–æ—Ä "–°—Ç—Ä–∞—Å—Ç—å –ø–æ–ø–æ–ª–∞–º"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–ù–∞–±–æ—Ä –∏–∑ –∫–ª—É–±–Ω–∏–∫–∏ –≤ –º–æ–ª–æ—á–Ω–æ–º –∏ –±–µ–ª–æ–º —à–æ–∫–æ–ª–∞–¥–µ —Å –ø–æ—Å—ã–ø–∫–æ–π –∏ –ø–µ—á–µ–Ω—å–µ–º.',
        image: '13.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –±–µ–ª—ã–π —à–æ–∫–æ–ª–∞–¥, –ø–µ—á–µ–Ω—å–µ, —Ä–æ–∑–æ–≤—ã–π –¥–µ–∫–æ—Ä',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 372000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 497000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 559000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 745000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 993000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1117000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1490000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1676000 }
        ]
    },

    // 6. –†–∞–π—Å–∫–æ–µ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏–µ ‚Äî –º–∏–∫—Å dark + milk
    {
        id: 6,
        name: '–ù–∞–±–æ—Ä "–†–∞–π—Å–∫–æ–µ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏–µ"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–°–æ—á–µ—Ç–∞–Ω–∏–µ —Å–æ—á–Ω–æ–π –∫–ª—É–±–Ω–∏–∫–∏ —Å –Ω–µ–∂–Ω—ã–º —Ç—ë–º–Ω—ã–º –∏ –º–æ–ª–æ—á–Ω—ã–º —à–æ–∫–æ–ª–∞–¥–æ–º, —É–∫—Ä–∞—à–µ–Ω–Ω–æ–π –∫–æ–∫–æ—Å–æ–≤–æ–π —Å—Ç—Ä—É–∂–∫–æ–π.',
        image: '16.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, —Ç—ë–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –∫–æ–∫–æ—Å–æ–≤–∞—è —Å—Ç—Ä—É–∂–∫–∞',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 373000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 498000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 560000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 747000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 996000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1120000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1493000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1680000 }
        ]
    },

    // 7. –®–æ–∫–æ–ª–∞–¥–Ω–∞—è —Å–∏–º—Ñ–æ–Ω–∏—è ‚Äî –±–µ–ª—ã–π + —Ä–æ–∑–æ–≤—ã–π + –º–æ–ª–æ—á–Ω—ã–π
    {
        id: 7,
        name: '–ù–∞–±–æ—Ä "–®–æ–∫–æ–ª–∞–¥–Ω–∞—è —Å–∏–º—Ñ–æ–Ω–∏—è"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–ò–∑—è—â–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –∫–ª—É–±–Ω–∏–∫–∏ –≤ –±–µ–ª–æ–º –∏ –º–æ–ª–æ—á–Ω–æ–º —à–æ–∫–æ–ª–∞–¥–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∏–¥–∞–º–∏ –¥–µ–∫–æ—Ä–∞: –æ—Ç –≤–æ–∑–¥—É—à–Ω–æ–π –∫–æ–∫–æ—Å–æ–≤–æ–π —Å—Ç—Ä—É–∂–∫–∏ –¥–æ –Ω–µ–∂–Ω—ã—Ö —Å–∞—Ö–∞—Ä–Ω—ã—Ö –∂–µ–º—á—É–∂–∏–Ω –∏ –∑–æ–ª–æ—Ç—ã—Ö –∞–∫—Ü–µ–Ω—Ç–æ–≤.',
        image: '11.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, –±–µ–ª—ã–π —à–æ–∫–æ–ª–∞–¥, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –∫–æ–∫–æ—Å–æ–≤–∞—è —Å—Ç—Ä—É–∂–∫–∞, –ø–æ—Å—ã–ø–∫–∞ —à–∞—Ä–∏–∫–∏, –∑–æ–ª–æ—Ç–æ',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 385000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 513000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 583000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 771000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 1025000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1153000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1538000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1730000 }
        ]
    },

    // 8. –ö–ª–∞—Å—Å–∏–∫–∞ ‚Äî dark + white + –Ω–µ–º–Ω–æ–≥–æ gold
    {
        id: 8,
        name: '–ù–∞–±–æ—Ä "–ö–ª–∞—Å—Å–∏–∫–∞"',
        description: '–ù–∞ —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä 9 —è–≥–æ–¥',
        fullDescription: '–ù–∞–±–æ—Ä –∏–∑ —è–≥–æ–¥ –≤ —Ç—ë–º–Ω–æ–º, –º–æ–ª–æ—á–Ω–æ–º –∏ –±–µ–ª–æ–º —à–æ–∫–æ–ª–∞–¥–µ —Å –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º –¥–µ–∫–æ—Ä–æ–º –∏ –∑–æ–ª–æ—Ç—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º.',
        image: '18.JPG',
        composition: '–ö–ª—É–±–Ω–∏–∫–∞, —Ç—ë–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –±–µ–ª—ã–π —à–æ–∫–æ–ª–∞–¥, –º–æ–ª–æ—á–Ω—ã–π —à–æ–∫–æ–ª–∞–¥, –∑–æ–ª–æ—Ç–∞—è –ø–æ—Å—ã–ø–∫–∞',
        sizes: '6 —è–≥–æ–¥ | 8 —è–≥–æ–¥ | 9 —è–≥–æ–¥ | 12 —è–≥–æ–¥ | 16 —è–≥–æ–¥ | 18 —è–≥–æ–¥ | 24 —è–≥–æ–¥—ã | 27 —è–≥–æ–¥—ã',
        quantities: [
            { label: '6 —è–≥–æ–¥',  value: '6',  price: 385000 },
            { label: '8 —è–≥–æ–¥',  value: '8',  price: 513000 },
            { label: '9 —è–≥–æ–¥',  value: '9',  price: 571000 },
            { label: '12 —è–≥–æ–¥', value: '12', price: 761000 },
            { label: '16 —è–≥–æ–¥', value: '16', price: 1011000 },
            { label: '18 —è–≥–æ–¥', value: '18', price: 1138000 },
            { label: '24 —è–≥–æ–¥—ã', value: '24', price: 1515000 },
            { label: '27 —è–≥–æ–¥—ã', value: '27', price: 1707000 }
        ]
    }
];

// ===== –ö–û–†–ó–ò–ù–ê –ò –û–ë–©–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
let cart = [];
const savedCart = localStorage.getItem('cart');
if (savedCart) {
    try {
        cart = JSON.parse(savedCart);
        updateCart();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:', error);
        cart = [];
    }
}

let favorites = [];
let currentDetailProduct = null;
let detailCounter = 1;

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
function formatPrice(value) {
    return value.toLocaleString('ru-RU'); // 1 493 000
}

// ===== –û–¢–†–ò–°–û–í–ö–ê –¢–û–í–ê–†–û–í –ù–ê –ì–õ–ê–í–ù–û–ô =====
function renderProducts() {
    const productGrid = document.getElementById('productGrid');
    productGrid.innerHTML = products.map(product => `
        <div class="product-card">
            <div class="product-image-wrapper">
                <div class="product-image">
                    <img src="${product.image}" alt="${product.name}">
                </div>
                <div class="favorite-icon ${favorites.includes(product.id) ? 'active' : ''}" onclick="toggleFavorite(${product.id}, event)">
                    ${favorites.includes(product.id) ? '‚ù§Ô∏è' : 'ü§ç'}
                </div>
            </div>
            <div class="product-info">
                <h3>${product.name}</h3>
                <p class="product-description">${product.description}</p>

                <div class="product-price">
                    ${formatPrice(product.quantities[0].price)} ‚Ç´
                </div>

                <div class="quantity-selector">
                    <label class="quantity-label">–ö–æ–ª-–≤–æ —è–≥–æ–¥</label>
                    <div class="select-with-icon" onclick="toggleDropdown(${product.id})">
                        <div class="select-icon">
                            <img src="${product.image}" alt="${product.name}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 5px;">
                        </div>
                        <div class="select-text" id="selected-${product.id}">
                            ${product.quantities[0].label}
                        </div>
                        <div class="select-arrow">‚ñº</div>
                    </div>

                    <select id="quantity-${product.id}" style="display: none;">
                        ${product.quantities.map(q => `
                            <option value="${q.value}" data-price="${q.price}">
                                ${q.label}
                            </option>
                        `).join('')}
                    </select>
                </div>

                <div class="product-actions">
                    <button class="btn-details" onclick="openProductDetail(${product.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                    <button class="btn-add-to-cart" onclick="addToCart(${product.id})">
                        –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

// ===== –ú–û–î–ê–õ–ö–ê –¢–û–í–ê–†–ê =====
function openProductDetail(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    currentDetailProduct = product;
    detailCounter = 1;

    document.getElementById('detailModalImage').innerHTML =
        `<img src="${product.image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover;">`;
    document.getElementById('detailModalTitle').textContent = product.name;
    document.getElementById('detailModalPrice').textContent =
        `${formatPrice(product.quantities[0].price)} ‚Ç´`;
    document.getElementById('detailDescription').textContent = product.fullDescription;
    document.getElementById('detailSizes').innerHTML =
        product.sizes + '<br>–¢–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–≥–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —è–≥–æ–¥—ã';
    document.getElementById('detailComposition').textContent = product.composition;
    document.getElementById('detailSelectIcon').innerHTML =
        `<img src="${product.image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;">`;
    document.getElementById('detailSelectedText').textContent = product.quantities[0].label;
    document.getElementById('detailCounter').textContent = '1';

    const favBtn = document.getElementById('detailFavoriteBtn');
    if (favorites.includes(productId)) {
        favBtn.textContent = '‚ù§Ô∏è';
        favBtn.classList.add('active');
    } else {
        favBtn.textContent = 'ü§ç';
        favBtn.classList.remove('active');
    }

    const select = document.getElementById('detailQuantitySelect');
    select.innerHTML = product.quantities.map((q, index) => `
        <option value="${q.value}" data-price="${q.price}" ${index === 0 ? 'selected' : ''}>
            ${q.label}
        </option>
    `).join('');

    select.onchange = function() {
        const selectedOption = this.options[this.selectedIndex];
        document.getElementById('detailSelectedText').textContent = selectedOption.text;
        detailCounter = 1;
        document.getElementById('detailCounter').textContent = '1';
        updateDetailTotalPrice();
    };

    document.getElementById('productDetailModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeDetailModal() {
    document.getElementById('productDetailModal').classList.remove('active');
    document.body.style.overflow = 'auto';
    currentDetailProduct = null;
}

function closeDetailModalOnOverlay(event) {
    if (event.target.id === 'productDetailModal') {
        closeDetailModal();
    }
}

// –ö–∞—Å—Ç–æ–º–Ω—ã–π dropdown –≤ –º–æ–¥–∞–ª–∫–µ
function toggleDetailDropdown() {
    const select = document.getElementById('detailQuantitySelect');
    const wrapper = document.querySelector('.detail-select-with-icon');

    document.querySelectorAll('.custom-dropdown').forEach(d => d.remove());

    const dropdown = document.createElement('div');
    dropdown.className = 'custom-dropdown';

    const rect = wrapper.getBoundingClientRect();
    dropdown.style.position = 'fixed';
    dropdown.style.top = (rect.bottom + 5) + 'px';
    dropdown.style.left = rect.left + 'px';
    dropdown.style.width = rect.width + 'px';

    Array.from(select.options).forEach(option => {
        const item = document.createElement('div');
        item.textContent = option.text;
        item.onclick = function() {
            select.value = option.value;
            select.dispatchEvent(new Event('change'));

            const selectedTextDiv = document.getElementById('detailSelectedText');
            if (selectedTextDiv) selectedTextDiv.textContent = option.text;

            dropdown.remove();
        };
        dropdown.appendChild(item);
    });

    document.body.appendChild(dropdown);

    setTimeout(() => {
        document.addEventListener('click', function closeDropdown(e) {
            if (!dropdown.contains(e.target) && !wrapper.contains(e.target)) {
                dropdown.remove();
                document.removeEventListener('click', closeDropdown);
            }
        });
    }, 0);
}

// –°—á—ë—Ç—á–∏–∫ –≤ –º–æ–¥–∞–ª–∫–µ
function increaseDetailCounter() {
    detailCounter++;
    document.getElementById('detailCounter').textContent = detailCounter;
    updateDetailTotalPrice();
}

function decreaseDetailCounter() {
    if (detailCounter > 1) {
        detailCounter--;
        document.getElementById('detailCounter').textContent = detailCounter;
        updateDetailTotalPrice();
    }
}

// –ü–µ—Ä–µ—Å—á—ë—Ç —Ü–µ–Ω—ã –≤ –º–æ–¥–∞–ª–∫–µ
function updateDetailTotalPrice() {
    const select = document.getElementById('detailQuantitySelect');
    const selectedOption = select.options[select.selectedIndex];
    const basePrice = parseInt(selectedOption.dataset.price);
    const totalPrice = basePrice * detailCounter;

    document.getElementById('detailModalPrice').textContent =
        `${formatPrice(totalPrice)} ‚Ç´`;
}

// –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –≤ –º–æ–¥–∞–ª–∫–µ
function toggleDetailFavorite() {
    if (!currentDetailProduct) return;

    const favBtn = document.getElementById('detailFavoriteBtn');
    const productId = currentDetailProduct.id;

    if (favorites.includes(productId)) {
        favorites = favorites.filter(id => id !== productId);
        favBtn.textContent = 'ü§ç';
        favBtn.classList.remove('active');
    } else {
        favorites.push(productId);
        favBtn.textContent = '‚ù§Ô∏è';
        favBtn.classList.add('active');
    }

    renderProducts();
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É –∏–∑ –º–æ–¥–∞–ª–∫–∏
function addToCartFromDetail() {
    if (!currentDetailProduct) return;

    const select = document.getElementById('detailQuantitySelect');
    const selectedOption = select.options[select.selectedIndex];
    const selectedQuantity = selectedOption.text;
    const selectedPrice = parseInt(selectedOption.dataset.price);

    const cartItem = {
        id: `${currentDetailProduct.id}-${selectedOption.value}`,
        productId: currentDetailProduct.id,
        name: currentDetailProduct.name,
        quantity: detailCounter,
        price: selectedPrice,
        emoji: 'üçì',
        size: selectedQuantity
    };

    const existingItem = cart.find(item => item.id === cartItem.id);

    if (existingItem) {
        existingItem.quantity += detailCounter;
    } else {
        cart.push(cartItem);
    }

    updateCart();

    const btn = document.querySelector('.btn-add-to-cart-detail');
    const originalText = btn.textContent;
    btn.textContent = '‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É';
    btn.style.background = '#4CAF50';
    setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
    }, 1500);

    setTimeout(() => {
        closeDetailModal();
    }, 1500);
}

// ===== –ò–ó–ë–†–ê–ù–ù–û–ï –ù–ê –ö–ê–†–¢–û–ß–ö–ê–• =====
function toggleFavorite(productId, event) {
    event.stopPropagation();
    const icon = event.currentTarget;

    if (favorites.includes(productId)) {
        favorites = favorites.filter(id => id !== productId);
        icon.textContent = 'ü§ç';
        icon.classList.remove('active');
    } else {
        favorites.push(productId);
        icon.textContent = '‚ù§Ô∏è';
        icon.classList.add('active');
    }
}

// ===== –ö–ê–°–¢–û–ú–ù–´–ô –î–†–û–ü–î–ê–£–ù –ù–ê –ì–õ–ê–í–ù–û–ô (–ö–ê–†–¢–û–ß–ö–ò) =====
function toggleDropdown(id) {
    const card = document.querySelector(`.product-card button[onclick="addToCart(${id})"]`).closest('.product-card');
    const select = card.querySelector('select');
    const wrapper = card.querySelector('.select-with-icon');
    const priceElement = card.querySelector('.product-price');

    document.querySelectorAll('.custom-dropdown').forEach(d => d.remove());

    const dropdown = document.createElement('div');
    dropdown.className = 'custom-dropdown';

    const rect = wrapper.getBoundingClientRect();
    dropdown.style.position = 'absolute';
    dropdown.style.top = (rect.bottom + window.scrollY + 5) + 'px';
    dropdown.style.left = (rect.left + window.scrollX) + 'px';
    dropdown.style.width = rect.width + 'px';

    Array.from(select.options).forEach(option => {
        const item = document.createElement('div');
        item.textContent = option.text;

        item.onclick = function() {
            select.value = option.value;

            const textDiv = card.querySelector('.select-text');
            if (textDiv) textDiv.textContent = option.text;

            const newPrice = parseInt(option.dataset.price);
            priceElement.textContent = `${formatPrice(newPrice)} ‚Ç´`;

            dropdown.remove();
        };
        dropdown.appendChild(item);
    });

    document.body.appendChild(dropdown);

    setTimeout(() => {
        document.addEventListener('click', function close(e) {
            if (!dropdown.contains(e.target) && !wrapper.contains(e.target)) {
                dropdown.remove();
                document.removeEventListener('click', close);
            }
        });
    }, 0);
}

// ===== –ö–û–†–ó–ò–ù–ê =====
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    const select = document.getElementById(`quantity-${productId}`);
    const selectedOption = select.options[select.selectedIndex];
    const selectedQuantity = selectedOption.text;
    const selectedPrice = parseInt(selectedOption.dataset.price);

    const cartItem = {
        id: `${productId}-${selectedOption.value}`,
        productId: productId,
        name: product.name,
        quantity: 1,
        price: selectedPrice,
        emoji: 'üçì',
        size: selectedQuantity
    };

    const existingItem = cart.find(item => item.id === cartItem.id);

    if (existingItem) {
        existingItem.quantity++;
    } else {
        cart.push(cartItem);
    }

    updateCart();

    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = '‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ';
    btn.style.background = '#4CAF50';
    setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
    }, 1000);
}

function updateCart() {
    const cartCount = document.getElementById('cartCount');
    const cartItemsContainer = document.getElementById('cartItemsContainer');
    const cartTotal = document.getElementById('cartTotal');

    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    cartCount.textContent = totalItems;
    cartTotal.textContent = `${formatPrice(totalPrice)}‚Ç´`;

    if (cart.length === 0) {
        cartItemsContainer.innerHTML = `
            <div class="empty-cart">
                <div class="empty-cart-icon">üõí</div>
                <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            </div>
        `;
    } else {
        cartItemsContainer.innerHTML = cart.map(item => `
            <div class="cart-item">
                <div class="cart-item-image">${item.emoji}</div>
                <div class="cart-item-info">
                    <h4>${item.name}</h4>
                    <p style="font-size: 0.85rem; color: #999; margin-bottom: 0.3rem;">${item.size}</p>
                    <div class="cart-item-price">${formatPrice(item.price)}‚Ç´</div>
                    <div class="cart-item-controls">
                        <button onclick="decreaseQuantity('${item.id}')">‚àí</button>
                        <span class="cart-item-quantity">${item.quantity}</span>
                        <button onclick="increaseQuantity('${item.id}')">+</button>
                    </div>
                </div>
                <span class="remove-item" onclick="removeFromCart('${item.id}')">√ó</span>
            </div>
        `).join('');
    }
    localStorage.setItem('cart', JSON.stringify(cart));
}

function increaseQuantity(itemId) {
    const item = cart.find(item => item.id === itemId);
    if (item) {
        item.quantity++;
        updateCart();
    }
}

function decreaseQuantity(itemId) {
    const item = cart.find(item => item.id === itemId);
    if (item && item.quantity > 1) {
        item.quantity--;
        updateCart();
    }
}

function removeFromCart(itemId) {
    cart = cart.filter(item => item.id !== itemId);
    updateCart();
}

function toggleCart() {
    const cartModal = document.getElementById('cartModal');
    const cartOverlay = document.getElementById('cartOverlay');
    cartModal.classList.toggle('active');
    cartOverlay.classList.toggle('active');
}

// ===== –§–û–†–ú–ê –û–ë–†–ê–¢–ù–û–ô –°–í–Ø–ó–ò (–ù–ï –ó–ê–ö–ê–ó) =====
function submitOrder() {
    const name = document.getElementById('nameInput').value;
    const phone = document.getElementById('phoneInput').value;
    const email = document.getElementById('emailInput').value;
    const message = document.getElementById('messageInput').value;

    if (!name || !phone || !email || !message) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
        return;
    }

    alert(`–°–ø–∞—Å–∏–±–æ, ${name}! –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É ${phone}.`);

    document.getElementById('nameInput').value = '';
    document.getElementById('phoneInput').value = '';
    document.getElementById('emailInput').value = '';
    document.getElementById('messageInput').value = '';
}

// ===== –ü–†–û–ö–†–£–¢–ö–ê, ESC, –ß–ï–ö-–ê–£–¢, –ö–û–ù–¢–ê–ö–¢–´ =====
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeDetailModal();
    }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞
renderProducts();

// –ú–æ–¥–∞–ª–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
function openCheckoutModal() {
    if (cart.length === 0) {
        alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!');
        return;
    }
    document.querySelector('.cart-modal').classList.remove('active');
    document.querySelector('.cart-overlay').classList.remove('active');

    document.getElementById('checkoutModal').style.display = 'flex';
    document.getElementById('checkoutOverlay').style.display = 'block';
}

function closeCheckoutModal() {
    document.getElementById('checkoutModal').style.display = 'none';
    document.getElementById('checkoutOverlay').style.display = 'none';
}

document.getElementById('checkoutForm').onsubmit = async function(e) {
    e.preventDefault();
    const form = e.target;
    const name = form.name.value;
    const contact = form.contact.value;
    const date = form.date.value;
    const address = form.address.value;

    let orderDetails = cart.map(item =>
        `${item.name} (${item.size}) x${item.quantity} - ${formatPrice(item.price*item.quantity)}‚Ç´`
    ).join('\n');
    let total = cart.reduce((sum,item)=>sum+item.price*item.quantity, 0);

    try {
        const response = await fetch('https://muddy-feather-8439.nastyadelonge554.workers.dev', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name,
                contact,
                date,
                address,
                orderDetails,
                total
            })
        });

        const data = await response.json();

        if (data.ok) {
            alert('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.');
            cart = [];
            localStorage.removeItem('cart');
            updateCart();
            closeCheckoutModal();
            toggleCart();
        } else {
            alert(data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞!');
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: –∑–∞–∫–∞–∑ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.');
        console.error(error);
    }
};

// –ù–∏–∂–Ω—è—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞
document.getElementById('contactSubmitBtn').onclick = async function() {
    const name = document.getElementById('nameInput').value.trim();
    const contact = document.getElementById('contactInput').value.trim();
    const email = document.getElementById('emailInput').value.trim();
    const message = document.getElementById('messageInput').value.trim();

    const nameIsValid = /^[a-zA-Z–∞-—è–ê-–Ø—ë–Å\s\-]{2,30}$/.test(name);
    if(!nameIsValid) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è');
        return;
    }

    if (!contact) {
        alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ Telegram –¥–ª—è —Å–≤—è–∑–∏!');
        return;
    }

    if (!/\S+@\S+\.\S+/.test(email)) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!');
        return;
    }

    if (!name || !contact) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã!');
        return;
    }

    try {
        const response = await fetch('https://muddy-feather-8439.nastyadelonge554.workers.dev', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, contact, email, message })
        });

        const data = await response.json();

        if (data.ok) {
            alert('–°–ø–∞—Å–∏–±–æ! –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ üòä');
            clearContactForm();
        } else {
            alert(data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è!');
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ!');
        console.error(error);
    }
};

function clearContactForm() {
    document.getElementById('nameInput').value = '';
    document.getElementById('contactInput').value = '';
    document.getElementById('emailInput').value = '';
    document.getElementById('messageInput').value = '';
}












